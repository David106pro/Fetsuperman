# 北京运营表格生成工具

## 📋 脚本简述

### 🎯 功能概述
北京运营表格生成工具是一个专为影视公司运营设计的自动化Excel表格处理工具，用于处理北京OTT项目的日常运营数据，包括专辑和剧集的注入、审核、送审和上线流程。

### 🔧 主要功能
1. **数据导入处理**
   - 导入专辑注入成功数据到总表
   - 导入剧集注入成功数据到总表
   - 导入审核结果数据到总表

2. **表格生成**
   - 生成专辑送审表
   - 生成剧集送审表
   - 生成上线表

3. **数据管理**
   - 自动备份总表
   - 审核状态格式统一
   - 文件占用检查

### 🚀 操作流程
1. **准备工作**
   - 将修改好的总表保存到桌面
   - 将三个输入表存入桌面"北京输入表格"文件夹

2. **运行脚本**
   - 启动程序，弹出UI交互界面
   - 选择需要执行的操作（可单独运行或整体运行）
   - 点击"执行勾选项"或"全部执行"

3. **结果输出**
   - 桌面生成送审表和上线表
   - 自动打开总表和生成的表格

### 📁 使用条件
- **操作系统**: Windows 10/11
- **Python环境**: Python 3.8+
- **必需包**: pandas, openpyxl, tkinter, psutil
- **文件格式**: Excel (.xlsx), CSV (.csv)
- **权限要求**: 需要文件读写权限

### 📂 文件结构
```
北京项目工具/
├── main.py                    # 主程序文件
├── README.md                  # 项目文档
├── setup.py                   # 环境配置脚本
├── setting/                   # 配置文件目录
│   └── config.json           # 用户配置
└── logs/                     # 日志文件目录
    └── *.log                 # 运行日志
```

### ⚙️ 配置说明
- **总表路径**: 默认桌面路径，可自定义
- **输入表格路径**: 默认"北京输入表格"文件夹
- **输出路径**: 可自定义送审表和上线表输出位置
- **备份设置**: 可选择是否自动备份总表
- **格式统一**: 可选择是否统一审核状态格式

---

## 📝 脚本版本更新历程

### v3.13 (2025-01-20) - 终端优化版
- **日期格式警告修复**: 修复所有pd.to_datetime调用的日期格式警告
- **终端输出清理**: 消除日期解析时的UserWarning警告信息
- **代码稳定性**: 添加dayfirst=True参数确保日期解析一致性

### v3.12 (2025-01-20) - Bug修复版
- **审核状态保护**: 修复上线表格和送审表格生成时意外修改总表审核状态的问题
- **标签更新优化**: 表格生成时只更新时间标签，保持审核状态原始值
- **数据完整性**: 确保总表中的审核状态不被意外修改
- **逻辑修正**: 上线表格生成时只替换申请上线时间标签，不修改审核状态

### v3.11 (2025-01-20) - 功能优化版
- **设置选项简化**: 删除"表格打开状态校验"和"是否设置审核状态格式"选项，这些功能现在始终启用
- **备份逻辑优化**: 使用固定文件名备份，每次覆盖，只保留一份备份文件
- **设置选项重命名**: 将"是否统一审批状态格式"改为"审核状态格式统一"，名称更简洁
- **配置键名优化**: 简化配置键名，提高代码可读性
- **功能稳定性提升**: 文件检查和审核状态格式设置现在始终启用，确保功能稳定性

### v3.10 (2025-01-20) - 智能映射版
- **文件检查设置优化**: 添加"表格打开状态校验"设置选项，可开启/关闭文件占用检查，默认开启
- **备份路径修正**: 备份文件保存在总表同路径下，不再创建子文件夹
- **格式统一功能修正**: 将未知审核状态映射到最接近的标准状态，而不是清空
- **设置界面完善**: 新增4个功能设置选项，提供更灵活的控制
- **智能状态映射**: 根据相似性将非标准状态映射到标准状态（通过、驳回、审核中、待重审、待提审）

### v3.9 (2025-01-20) - 用户体验版
- **初始校验功能**: 添加文件占用检查，检测Excel文件是否被打开，提供"关闭表格"选项自动关闭占用进程
- **列宽自适应限制**: 限制最大列宽为表头字数的两倍，避免过宽列影响表格美观
- **总表备份功能**: 在设置中添加备份选项，执行前自动备份总表到备份文件夹
- **清除全部选择按钮**: 替代"全部执行"按钮，一键清除所有勾选项
- **审核状态格式设置**: 在设置中添加审核状态格式选项，可选择是否应用颜色和加粗样式
- **进程管理功能**: 使用psutil库自动检测和关闭占用文件的进程
- **用户体验优化**: 更友好的错误提示和操作流程，支持文件占用时的自动处理

### v3.8 (2025-01-20) - 界面优化版
- **界面布局优化**: 重新设计UI布局，提高界面美观度和用户体验
- **设置界面改进**: 优化设置窗口布局，使用紧凑型设计
- **按钮布局调整**: 将设置按钮与执行按钮放置在同一水平线，界面更加协调
- **界面紧凑性提升**: 整体布局更加紧凑，信息密度更高

### v3.7 (2025-01-20) - 审核状态优化版
- **审核状态颜色设置**: 为不同审核状态设置不同颜色（通过-绿色、驳回-红色、审核中-黑色、待提审-黄色、待重审-橙色）
- **字体样式优化**: 驳回状态加粗显示，其他状态正常显示
- **状态清洗功能**: 智能清洗和统一审核状态格式
- **格式统一设置**: 添加审核状态格式统一选项

### v3.6 (2025-01-20) - 列宽优化版
- **列宽自适应**: 根据表头和数据内容自动调整Excel列宽
- **中文字符处理**: 中文字符按2个字符宽度计算
- **最大宽度限制**: 限制最大列宽为表头字数的两倍
- **ID列格式优化**: 所有ID列设置为文本格式，避免科学计数法显示

### v3.5 (2025-01-20) - 边框完善版
- **全边框设置**: 为生成的送审表和上线表添加完整边框
- **边框样式统一**: 使用细线边框，保持表格美观
- **覆盖范围优化**: 边框覆盖所有数据单元格，包括空单元格

### v3.4 (2025-01-20) - 送审逻辑修正版
- **专辑送审表修正**: 修复专辑送审表中节目状态字段为空的问题
- **审核状态更新**: 送审时间标记"T"时，自动更新审核状态为"审核中"
- **状态同步**: 包括原本标记"驳回"的行也会更新为"审核中"

### v3.3 (2025-01-20) - 上线表完善版
- **上线表生成**: 完善上线表生成逻辑，确保字段映射正确
- **表头验证**: 验证上线表表头与需求文档一致
- **数据完整性**: 确保所有必需字段正确填充

### v3.2 (2025-01-20) - 错误处理版
- **异常处理**: 完善所有操作的异常处理机制
- **错误提示**: 提供详细的错误信息和解决建议
- **日志记录**: 添加详细的日志记录功能
- **用户友好**: 优化错误提示的用户体验

### v3.1 (2025-01-20) - 基础功能版
- **核心功能实现**: 实现所有基础数据处理功能
- **UI界面**: 创建用户友好的图形界面
- **文件操作**: 支持Excel和CSV文件的读写操作
- **数据映射**: 实现复杂的数据字段映射逻辑

### v3.0 (2025-01-20) - 初始版本
- **项目初始化**: 创建基础项目结构
- **需求分析**: 完成详细的功能需求分析
- **技术选型**: 确定使用Python + pandas + openpyxl技术栈
- **架构设计**: 设计模块化的代码架构

---

## 🔧 技术特性

### 数据处理能力
- **大数据处理**: 支持处理大量Excel数据
- **智能映射**: 自动识别和映射数据字段
- **格式转换**: 自动处理时间格式和数据格式转换
- **状态管理**: 智能管理审核状态和流程状态

### 用户体验
- **图形界面**: 直观的图形用户界面
- **操作简单**: 一键式操作，减少人工干预
- **实时反馈**: 实时显示操作进度和结果
- **错误处理**: 友好的错误提示和解决建议

### 系统稳定性
- **文件保护**: 自动备份重要文件
- **进程管理**: 智能处理文件占用问题
- **异常恢复**: 完善的异常处理和恢复机制
- **日志记录**: 详细的操作日志记录

### 扩展性
- **模块化设计**: 便于功能扩展和维护
- **配置管理**: 灵活的配置选项
- **路径自定义**: 支持自定义文件路径
- **格式兼容**: 支持多种文件格式

---

## 📞 技术支持

如有问题或建议，请联系开发团队。 